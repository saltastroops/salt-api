[tox]
isolated_build = True
envlist = py39

[testenv]
passenv = *
setenv =
    SDB_DSN={env:SDB_DSN:mysql+pymysql://piptquerytool:p7p6qt@sdbsandbox.cape.saao.ac.za:3306/sdb_daily_test}
    PROPOSALS_DIR={env:PROPOSALS_DIR:tests/}
allowlist_externals = poetry
commands =
    poetry install -v
    poetry run isort --check saltapi tests
    poetry run black --check saltapi tests
    poetry run flake8 saltapi tests
    poetry run mypy saltapi
    poetry run bandit -r saltapi
    poetry run pytest --mock-db-data --db-data-dir tests/salt-testdata/salt-api/ \
    -W ignore::pytest.PytestUnraisableExceptionWarning

[flake8]
docstring-convention = numpy
exclude = .git, .tox, __pycache__, .venv
max-line-length = 88
per-file-ignores =
    saltapi/repository/block_repository.py:E501
    saltapi/repository/proposal_repository.py:E501
    saltapi/web/api/*.py:E501
    saltapi/web/schema/*.py:E501
    tests/conftest.py:E402
